# Restarts a forked chain, and runs production tests with gas reports against it
{{> job-header.yml}}
steps:
  - run: |
      whoami
  - checkout
  - attach_workspace:
      at: .
  - run:
      command: npx hardhat node --target-network mainnet
      background: true
  - cmd-wait-for-rpc
  - run: |
      echo "------"
      whoami
      echo "------"
      cat ~/.ssh/known_hosts
      echo "------"
      ssh-keyscan -t rsa github.com >> ~/.ssh/known_hosts
      echo "------"
      cat ~/.ssh/known_hosts
      echo "------"
      npm run test:prod:gas -- --target-network mainnet && npm run codechecks codechecks.prod.yml
  - store_artifacts:
      path: test-gas-used-prod.log
